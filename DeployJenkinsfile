def groupId = 'com.luxhub.agora'
def groupPath = groupId.replace('.', '/')
def artifactId = 'agora-front'
def version = params['release.version']
def mvnCoordinates = "${groupId}:${artifactId}:${version}"
def artifactFile = "${artifactId}-${version}-bin.zip"
def snapshotVersion = version.endsWith('-SNAPSHOT')
def nexusId = snapshotVersion ? 'nexus-snapshots' : 'nexus-releases'
def nexusUrl = snapshotVersion
    ? 'https://nexus.luxhub.local:9443/repository/maven-snapshots'
    : 'https://nexus.luxhub.local:9443/repository/maven-releases'
def actualLocation = ''

jnkUsername = params['release.jenkinsUsername'] // 'jenk2adm'
destinationServer = params['release.destination'] // port1-dev.luxhu.local


pipeline {

    agent {
        label 'master'
    }

    parameters {

    }

    stages {
        stage('Deploy') {
            steps {
                echo "Deploying to ${params.deployTarget}"
            }
        }
    }

    post {
        success {
            mail subject: "Artifact '${artifactFile}' published to Nexus",
                    from: 'Jenkins <jenkins@luxhub.com>',
                    to: 'patrice.jacquot@luxhub.com',
                    mimeType: 'text/html',
                    body: """
                        <html><body>
                        <h1>${currentBuild.currentResult}: ${env.JOB_BASE_NAME}</h1>
                        <p>
                            <a href="${env.BUILD_URL}">Build <strong>#${env.BUILD_NUMBER}</strong></a> of the job <strong>${env.JOB_NAME}</strong>
                            ran on the branch <strong>${params['git.branch']}</strong>.
                        </p>
                        <p>
                            Artifact <a href="${actualLocation}"><strong>${mvnCoordinates}</a></strong> has been published to <strong>${nexusId}</strong>.
                        </p>
                        </body></html>
                      """
        }
        always {
            deleteDir()
        }
    }
}
